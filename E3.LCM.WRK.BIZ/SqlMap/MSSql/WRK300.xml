<?xml version="1.0" encoding="euc-kr" ?>
<sqlMap namespace="E3.LCM.WRK.BIZ" xmlns="http://ibatis.apache.org/mapping" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" >

	<statements>
		<select id="WRK300_SELECT">
			<![CDATA[
			SELECT MA.PLANT_ID
				  ,MA.TA_ID
				  ,MA.FACILITY_KND
				  ,(SELECT CODE_NAME FROM E3_CODE WHERE PARENT_ID = 'FACT_KND' AND CODE_ID = MA.FACILITY_KND AND USE_YN = 'Y') FACILITY_KND_NM
				  ,MA.PROCESS_CD
				  ,MA.FACILITY_NO
				  ,MA.FACILITY_NM
				  ,MA.RMK
				  ,MA.STEP1_CD
				  ,(SELECT CODE_NAME FROM E3_CODE WHERE PARENT_ID = 'JOB_KND' AND CODE_ID = MA.STEP1_CD AND USE_YN = 'Y') STEP1_NM
				  ,MA.STEP1_STATUS
				  ,(SELECT CODE_NAME FROM E3_CODE WHERE PARENT_ID = 'WK_STATUS' AND CODE_ID = MA.STEP1_STATUS AND USE_YN = 'Y') +
					' ' + MA.STEP1_COMP_DT + ' ' + MA.STEP1_MNGR_NM AS STEP1_STATUS_NM 
				  ,MA.STEP1_AUTH

				  ,MA.STEP2_CD
				  ,(SELECT CODE_NAME FROM E3_CODE WHERE PARENT_ID = 'JOB_KND' AND CODE_ID = MA.STEP2_CD AND USE_YN = 'Y') STEP2_NM
				  ,MA.STEP2_STATUS
				  ,(SELECT CODE_NAME FROM E3_CODE WHERE PARENT_ID = 'WK_STATUS' AND CODE_ID = MA.STEP2_STATUS AND USE_YN = 'Y') +
					' ' + MA.STEP2_COMP_DT + ' ' + MA.STEP2_MNGR_NM AS STEP2_STATUS_NM 
				  ,MA.STEP2_AUTH

				  ,MA.STEP2_CD
				  ,(SELECT CODE_NAME FROM E3_CODE WHERE PARENT_ID = 'JOB_KND' AND CODE_ID = MA.STEP2_CD AND USE_YN = 'Y') STEP2_NM
				  ,MA.STEP2_STATUS
				  ,(SELECT CODE_NAME FROM E3_CODE WHERE PARENT_ID = 'WK_STATUS' AND CODE_ID = MA.STEP2_STATUS AND USE_YN = 'Y') +
					' ' + MA.STEP2_COMP_DT + ' ' + MA.STEP2_MNGR_NM AS STEP2_STATUS_NM 
				  ,MA.STEP2_AUTH

				  ,MA.STEP3_CD
				  ,(SELECT CODE_NAME FROM E3_CODE WHERE PARENT_ID = 'JOB_KND' AND CODE_ID = MA.STEP3_CD AND USE_YN = 'Y') STEP3_NM
				  ,MA.STEP3_STATUS
				  ,(SELECT CODE_NAME FROM E3_CODE WHERE PARENT_ID = 'WK_STATUS' AND CODE_ID = MA.STEP3_STATUS AND USE_YN = 'Y') +
					' ' + MA.STEP3_COMP_DT + ' ' + MA.STEP3_MNGR_NM AS STEP3_STATUS_NM 
				  ,MA.STEP3_AUTH

				  ,MA.STEP4_CD
				  ,(SELECT CODE_NAME FROM E3_CODE WHERE PARENT_ID = 'JOB_KND' AND CODE_ID = MA.STEP4_CD AND USE_YN = 'Y') STEP4_NM
				  ,MA.STEP4_STATUS
				  ,(SELECT CODE_NAME FROM E3_CODE WHERE PARENT_ID = 'WK_STATUS' AND CODE_ID = MA.STEP4_STATUS AND USE_YN = 'Y') +
					' ' + MA.STEP4_COMP_DT + ' ' + MA.STEP4_MNGR_NM AS STEP4_STATUS_NM 
				  ,MA.STEP4_AUTH

				  ,MA.STEP5_CD
				  ,(SELECT CODE_NAME FROM E3_CODE WHERE PARENT_ID = 'JOB_KND' AND CODE_ID = MA.STEP5_CD AND USE_YN = 'Y') STEP5_NM
				  ,MA.STEP5_STATUS
				  ,(SELECT CODE_NAME FROM E3_CODE WHERE PARENT_ID = 'WK_STATUS' AND CODE_ID = MA.STEP5_STATUS AND USE_YN = 'Y') +
					' ' + MA.STEP5_COMP_DT + ' ' + MA.STEP5_MNGR_NM AS STEP5_STATUS_NM 
				  ,MA.STEP5_AUTH

				  ,MA.STEP6_CD
				  ,(SELECT CODE_NAME FROM E3_CODE WHERE PARENT_ID = 'JOB_KND' AND CODE_ID = MA.STEP6_CD AND USE_YN = 'Y') STEP6_NM
				  ,MA.STEP6_STATUS
				  ,(SELECT CODE_NAME FROM E3_CODE WHERE PARENT_ID = 'WK_STATUS' AND CODE_ID = MA.STEP6_STATUS AND USE_YN = 'Y') +
					' ' + MA.STEP6_COMP_DT + ' ' + MA.STEP6_MNGR_NM AS STEP6_STATUS_NM 
				  ,MA.STEP6_AUTH

				  ,MA.STEP7_CD
				  ,(SELECT CODE_NAME FROM E3_CODE WHERE PARENT_ID = 'JOB_KND' AND CODE_ID = MA.STEP7_CD AND USE_YN = 'Y') STEP7_NM
				  ,MA.STEP7_STATUS
				  ,(SELECT CODE_NAME FROM E3_CODE WHERE PARENT_ID = 'WK_STATUS' AND CODE_ID = MA.STEP7_STATUS AND USE_YN = 'Y') +
					' ' + MA.STEP7_COMP_DT + ' ' + MA.STEP7_MNGR_NM AS STEP7_STATUS_NM 
				  ,MA.STEP7_AUTH

				  ,MA.STEP8_CD
				  ,(SELECT CODE_NAME FROM E3_CODE WHERE PARENT_ID = 'JOB_KND' AND CODE_ID = MA.STEP8_CD AND USE_YN = 'Y') STEP8_NM
				  ,MA.STEP8_STATUS
				  ,(SELECT CODE_NAME FROM E3_CODE WHERE PARENT_ID = 'WK_STATUS' AND CODE_ID = MA.STEP8_STATUS AND USE_YN = 'Y') +
					' ' + MA.STEP8_COMP_DT + ' ' + MA.STEP8_MNGR_NM AS STEP8_STATUS_NM 
				  ,MA.STEP8_AUTH

				  ,MA.STEP9_CD
				  ,(SELECT CODE_NAME FROM E3_CODE WHERE PARENT_ID = 'JOB_KND' AND CODE_ID = MA.STEP9_CD AND USE_YN = 'Y') STEP9_NM
				  ,MA.STEP9_STATUS
				  ,(SELECT CODE_NAME FROM E3_CODE WHERE PARENT_ID = 'WK_STATUS' AND CODE_ID = MA.STEP9_STATUS AND USE_YN = 'Y') +
					' ' + MA.STEP9_COMP_DT + ' ' + MA.STEP9_MNGR_NM AS STEP9_STATUS_NM 
				  ,MA.STEP9_AUTH

				  ,'N' AS ROW_STATE
				  ,LEN(CONCAT(STEP1_CD, STEP2_CD, STEP3_CD, STEP4_CD, STEP5_CD, STEP6_CD, STEP7_CD, STEP8_CD, STEP9_CD)) / 5  AS ING_STEP
			FROM (
				SELECT T1.PLANT_ID
					  ,T1.TA_ID
					  ,T1.FACILITY_KND
					  ,(SELECT CODE_NAME FROM E3_CODE WHERE CODE_ID = T1.FACILITY_KND AND USE_YN = 'Y') FACILITY_KND_NM
					  ,T1.PROCESS_CD
					  ,T1.FACILITY_NO
					  ,T1.FACILITY_NM
					  ,T1.RMK
					  ,ISNULL(S1.STEP_CD, T2.STEP1_CD) AS STEP1_CD
					  ,S1.COMP_DT AS STEP1_COMP_DT
					  ,S1.MNGR_ID AS STEP1_MNGR_ID
					  ,(SELECT USER_NAME FROM E3_USER WHERE USER_ID = S1.MNGR_ID AND USE_YN = 'Y') AS STEP1_MNGR_NM
					  ,CASE WHEN S1.WK_STATUS IS NULL THEN 'WN' ELSE S1.WK_STATUS END STEP1_STATUS
					  ,CASE WHEN EXISTS (SELECT 1
										  FROM WK_JOB_AUTH_MAPPING R1 LEFT OUTER JOIN E3_USER_AUTH_MAPPING R2 ON R1.AUTHORITY_ID = R2.AUTHORITY_ID
										 WHERE R2.USER_ID = #LOGINID#
										   AND R1.JOB_ID = ISNULL(S1.STEP_CD, T2.STEP1_CD)) THEN 'Y' ELSE 'N' END AS STEP1_AUTH
					  ,CASE WHEN S1.STEP_CD IS NOT NULL THEN ISNULL(S2.STEP_CD, T2.STEP2_CD)
							ELSE ''
					   END STEP2_CD
					  ,S2.COMP_DT AS STEP2_COMP_DT
					  ,S2.MNGR_ID AS STEP2_MNGR_ID
					  ,(SELECT USER_NAME FROM E3_USER WHERE USER_ID = S2.MNGR_ID AND USE_YN = 'Y') AS STEP2_MNGR_NM
					  ,CASE WHEN S1.STEP_CD IS NOT NULL THEN ISNULL(S2.WK_STATUS, 'WN')
							ELSE ''
					   END STEP2_STATUS
					  ,CASE WHEN EXISTS (SELECT 1
										  FROM WK_JOB_AUTH_MAPPING R1 LEFT OUTER JOIN E3_USER_AUTH_MAPPING R2 ON R1.AUTHORITY_ID = R2.AUTHORITY_ID
										 WHERE R2.USER_ID = #LOGINID#
										   AND R1.JOB_ID = ISNULL(S2.STEP_CD, T2.STEP2_CD)) THEN 'Y' ELSE 'N' END AS STEP2_AUTH

					  ,CASE WHEN S2.STEP_CD IS NOT NULL THEN ISNULL(S3.STEP_CD, T2.STEP3_CD)
							ELSE ''
					   END STEP3_CD
					  ,S3.COMP_DT AS STEP3_COMP_DT
					  ,S3.MNGR_ID AS STEP3_MNGR_ID
					  ,(SELECT USER_NAME FROM E3_USER WHERE USER_ID = S3.MNGR_ID AND USE_YN = 'Y') AS STEP3_MNGR_NM
					  ,CASE WHEN S2.STEP_CD IS NOT NULL THEN ISNULL(S3.WK_STATUS, 'WN')
							ELSE ''
					   END STEP3_STATUS
					  ,CASE WHEN EXISTS (SELECT 1
										  FROM WK_JOB_AUTH_MAPPING R1 LEFT OUTER JOIN E3_USER_AUTH_MAPPING R2 ON R1.AUTHORITY_ID = R2.AUTHORITY_ID
										 WHERE R2.USER_ID = #LOGINID#
										   AND R1.JOB_ID = ISNULL(S3.STEP_CD, T2.STEP3_CD)) THEN 'Y' ELSE 'N' END AS STEP3_AUTH

					  ,CASE WHEN S3.STEP_CD IS NOT NULL THEN ISNULL(S4.STEP_CD, T2.STEP4_CD)
							ELSE ''
					   END STEP4_CD
					  ,S4.COMP_DT AS STEP4_COMP_DT
					  ,S4.MNGR_ID AS STEP4_MNGR_ID
					  ,(SELECT USER_NAME FROM E3_USER WHERE USER_ID = S4.MNGR_ID AND USE_YN = 'Y') AS STEP4_MNGR_NM
					  ,CASE WHEN S3.STEP_CD IS NOT NULL THEN ISNULL(S4.WK_STATUS, 'WN')
							ELSE ''
					   END STEP4_STATUS
					  ,CASE WHEN EXISTS (SELECT 1
										  FROM WK_JOB_AUTH_MAPPING R1 LEFT OUTER JOIN E3_USER_AUTH_MAPPING R2 ON R1.AUTHORITY_ID = R2.AUTHORITY_ID
										 WHERE R2.USER_ID = #LOGINID#
										   AND R1.JOB_ID = ISNULL(S4.STEP_CD, T2.STEP4_CD)) THEN 'Y' ELSE 'N' END AS STEP4_AUTH

					  ,CASE WHEN S4.STEP_CD IS NOT NULL THEN ISNULL(S5.STEP_CD, T2.STEP5_CD)
							ELSE ''
					   END STEP5_CD
					  ,S5.COMP_DT AS STEP5_COMP_DT
					  ,S5.MNGR_ID AS STEP5_MNGR_ID
					  ,(SELECT USER_NAME FROM E3_USER WHERE USER_ID = S5.MNGR_ID AND USE_YN = 'Y') AS STEP5_MNGR_NM
					  ,CASE WHEN S4.STEP_CD IS NOT NULL THEN ISNULL(S5.WK_STATUS, 'WN')
							ELSE ''
					   END STEP5_STATUS
					  ,CASE WHEN EXISTS (SELECT 1
										  FROM WK_JOB_AUTH_MAPPING R1 LEFT OUTER JOIN E3_USER_AUTH_MAPPING R2 ON R1.AUTHORITY_ID = R2.AUTHORITY_ID
										 WHERE R2.USER_ID = #LOGINID#
										   AND R1.JOB_ID = ISNULL(S5.STEP_CD, T2.STEP5_CD)) THEN 'Y' ELSE 'N' END AS STEP5_AUTH

					  ,CASE WHEN S5.STEP_CD IS NOT NULL THEN ISNULL(S6.STEP_CD, T2.STEP6_CD)
							ELSE ''
					   END STEP6_CD
					  ,S6.COMP_DT AS STEP6_COMP_DT
					  ,S6.MNGR_ID AS STEP6_MNGR_ID
					  ,(SELECT USER_NAME FROM E3_USER WHERE USER_ID = S6.MNGR_ID AND USE_YN = 'Y') AS STEP6_MNGR_NM
					  ,CASE WHEN S5.STEP_CD IS NOT NULL THEN ISNULL(S6.WK_STATUS, 'WN')
							ELSE ''
					   END STEP6_STATUS
					  ,CASE WHEN EXISTS (SELECT 1
										  FROM WK_JOB_AUTH_MAPPING R1 LEFT OUTER JOIN E3_USER_AUTH_MAPPING R2 ON R1.AUTHORITY_ID = R2.AUTHORITY_ID
										 WHERE R2.USER_ID = #LOGINID#
										   AND R1.JOB_ID = ISNULL(S6.STEP_CD, T2.STEP6_CD)) THEN 'Y' ELSE 'N' END AS STEP6_AUTH

					  ,CASE WHEN S6.STEP_CD IS NOT NULL THEN ISNULL(S7.STEP_CD, T2.STEP7_CD)
							ELSE ''
					   END STEP7_CD
					  ,S7.COMP_DT AS STEP7_COMP_DT
					  ,S7.MNGR_ID AS STEP7_MNGR_ID
					  ,(SELECT USER_NAME FROM E3_USER WHERE USER_ID = S7.MNGR_ID AND USE_YN = 'Y') AS STEP7_MNGR_NM
					  ,CASE WHEN S6.STEP_CD IS NOT NULL THEN ISNULL(S7.WK_STATUS, 'WN')
							ELSE ''
					   END STEP7_STATUS
					  ,CASE WHEN EXISTS (SELECT 1
										  FROM WK_JOB_AUTH_MAPPING R1 LEFT OUTER JOIN E3_USER_AUTH_MAPPING R2 ON R1.AUTHORITY_ID = R2.AUTHORITY_ID
										 WHERE R2.USER_ID = #LOGINID#
										   AND R1.JOB_ID = ISNULL(S7.STEP_CD, T2.STEP7_CD)) THEN 'Y' ELSE 'N' END AS STEP7_AUTH

					  ,CASE WHEN S7.STEP_CD IS NOT NULL THEN ISNULL(S8.STEP_CD, T2.STEP8_CD)
							ELSE ''
					   END STEP8_CD
					  ,S8.COMP_DT AS STEP8_COMP_DT
					  ,S8.MNGR_ID AS STEP8_MNGR_ID
					  ,(SELECT USER_NAME FROM E3_USER WHERE USER_ID = S8.MNGR_ID AND USE_YN = 'Y') AS STEP8_MNGR_NM
					  ,CASE WHEN S7.STEP_CD IS NOT NULL THEN ISNULL(S8.WK_STATUS, 'WN')
							ELSE ''
					   END STEP8_STATUS
					  ,CASE WHEN EXISTS (SELECT 1
										  FROM WK_JOB_AUTH_MAPPING R1 LEFT OUTER JOIN E3_USER_AUTH_MAPPING R2 ON R1.AUTHORITY_ID = R2.AUTHORITY_ID
										 WHERE R2.USER_ID = #LOGINID#
										   AND R1.JOB_ID = ISNULL(S8.STEP_CD, T2.STEP8_CD)) THEN 'Y' ELSE 'N' END AS STEP8_AUTH

					  ,CASE WHEN S8.STEP_CD IS NOT NULL THEN ISNULL(S9.STEP_CD, T2.STEP9_CD)
							ELSE ''
					   END STEP9_CD
					  ,S9.COMP_DT AS STEP9_COMP_DT
					  ,S9.MNGR_ID AS STEP9_MNGR_ID
					  ,(SELECT USER_NAME FROM E3_USER WHERE USER_ID = S9.MNGR_ID AND USE_YN = 'Y') AS STEP9_MNGR_NM
					  ,CASE WHEN S8.STEP_CD IS NOT NULL THEN ISNULL(S9.WK_STATUS, 'WN')
							ELSE ''
					   END STEP9_STATUS
					  ,CASE WHEN EXISTS (SELECT 1
										  FROM WK_JOB_AUTH_MAPPING R1 LEFT OUTER JOIN E3_USER_AUTH_MAPPING R2 ON R1.AUTHORITY_ID = R2.AUTHORITY_ID
										 WHERE R2.USER_ID = #LOGINID#
										   AND R1.JOB_ID = ISNULL(S9.STEP_CD, T2.STEP9_CD)) THEN 'Y' ELSE 'N' END AS STEP9_AUTH
				  FROM WK_FACILITY_INFO T1 
					   LEFT OUTER JOIN WK_FACILITY_STEP T2 ON T1.PLANT_ID = T2.PLANT_ID AND T1.TA_ID = T2.TA_ID AND T1.FACILITY_KND = T2.FACILITY_KND
					   LEFT OUTER JOIN WK_SIGN_SHEET S1 ON T1.PLANT_ID = S1.PLANT_ID AND T1.TA_ID = S1.TA_ID AND T1.FACILITY_KND = S1.FACILITY_KND AND T1.PROCESS_CD = S1.PROCESS_CD AND T1.FACILITY_NO = S1.FACILITY_NO AND T2.STEP1_CD = S1.STEP_CD
					   LEFT OUTER JOIN WK_SIGN_SHEET S2 ON T1.PLANT_ID = S2.PLANT_ID AND T1.TA_ID = S2.TA_ID AND T1.FACILITY_KND = S2.FACILITY_KND AND T1.PROCESS_CD = S2.PROCESS_CD AND T1.FACILITY_NO = S2.FACILITY_NO AND T2.STEP2_CD = S2.STEP_CD
					   LEFT OUTER JOIN WK_SIGN_SHEET S3 ON T1.PLANT_ID = S3.PLANT_ID AND T1.TA_ID = S3.TA_ID AND T1.FACILITY_KND = S3.FACILITY_KND AND T1.PROCESS_CD = S3.PROCESS_CD AND T1.FACILITY_NO = S3.FACILITY_NO AND T2.STEP3_CD = S3.STEP_CD
					   LEFT OUTER JOIN WK_SIGN_SHEET S4 ON T1.PLANT_ID = S4.PLANT_ID AND T1.TA_ID = S4.TA_ID AND T1.FACILITY_KND = S4.FACILITY_KND AND T1.PROCESS_CD = S4.PROCESS_CD AND T1.FACILITY_NO = S4.FACILITY_NO AND T2.STEP4_CD = S4.STEP_CD
					   LEFT OUTER JOIN WK_SIGN_SHEET S5 ON T1.PLANT_ID = S5.PLANT_ID AND T1.TA_ID = S5.TA_ID AND T1.FACILITY_KND = S5.FACILITY_KND AND T1.PROCESS_CD = S5.PROCESS_CD AND T1.FACILITY_NO = S5.FACILITY_NO AND T2.STEP5_CD = S5.STEP_CD
					   LEFT OUTER JOIN WK_SIGN_SHEET S6 ON T1.PLANT_ID = S6.PLANT_ID AND T1.TA_ID = S6.TA_ID AND T1.FACILITY_KND = S6.FACILITY_KND AND T1.PROCESS_CD = S6.PROCESS_CD AND T1.FACILITY_NO = S6.FACILITY_NO AND T2.STEP6_CD = S6.STEP_CD
					   LEFT OUTER JOIN WK_SIGN_SHEET S7 ON T1.PLANT_ID = S7.PLANT_ID AND T1.TA_ID = S7.TA_ID AND T1.FACILITY_KND = S7.FACILITY_KND AND T1.PROCESS_CD = S7.PROCESS_CD AND T1.FACILITY_NO = S7.FACILITY_NO AND T2.STEP7_CD = S7.STEP_CD
					   LEFT OUTER JOIN WK_SIGN_SHEET S8 ON T1.PLANT_ID = S8.PLANT_ID AND T1.TA_ID = S8.TA_ID AND T1.FACILITY_KND = S8.FACILITY_KND AND T1.PROCESS_CD = S8.PROCESS_CD AND T1.FACILITY_NO = S8.FACILITY_NO AND T2.STEP8_CD = S8.STEP_CD
					   LEFT OUTER JOIN WK_SIGN_SHEET S9 ON T1.PLANT_ID = S9.PLANT_ID AND T1.TA_ID = S9.TA_ID AND T1.FACILITY_KND = S9.FACILITY_KND AND T1.PROCESS_CD = S9.PROCESS_CD AND T1.FACILITY_NO = S9.FACILITY_NO AND T2.STEP9_CD = S9.STEP_CD
			     WHERE 1=1
			]]>

			<isNotNull property="PLANT_ID">
				<isNotEmpty property="PLANT_ID">
					AND T1.PLANT_ID = #PLANT_ID#
				</isNotEmpty>
			</isNotNull>
			<isNotNull property="TA_ID">
				<isNotEmpty property="TA_ID">
					AND T1.TA_ID = #TA_ID#
				</isNotEmpty>
			</isNotNull>
			<isNotNull property="FACILITY_KND">
				<isNotEmpty property="FACILITY_KND">
					AND T1.FACILITY_KND = #FACILITY_KND#
				</isNotEmpty>
			</isNotNull>
			<isNotNull property="PROCESS_CD">
				<isNotEmpty property="PROCESS_CD">
					AND T1.PROCESS_CD = #PROCESS_CD#
				</isNotEmpty>
			</isNotNull>
			<isNotNull property="FACILITY_NO">
				<isNotEmpty property="FACILITY_NO">
					AND T1.FACILITY_NO LIKE '%' + #FACILITY_NO# + '%'
				</isNotEmpty>
			</isNotNull>
			<isNotNull property="FACILITY_NM">
				<isNotEmpty property="FACILITY_NM">
					AND T1.FACILITY_NM LIKE '%' + #FACILITY_NM# + '%'
				</isNotEmpty>
			</isNotNull>
			) MA
			ORDER BY MA.PLANT_ID, MA.TA_ID, MA.FACILITY_KND, MA.PROCESS_CD, MA.FACILITY_NO
		</select>

		<select id="WRK300_CHK_CNT">
			<![CDATA[
			SELECT
				 COUNT(1) CNT
			FROM WK_FACILITY_INFO A /* 설비정보 관리*/
			WHERE 1 = 1
			AND PLANT_ID = #PLANT_ID#
			AND TA_ID = #TA_ID#
			AND FACILITY_KND = #FACILITY_KND#    
			AND PROCESS_CD = #PROCESS_CD#    
			AND FACILITY_NO = #FACILITY_NO#    
			]]> 
		</select>

		<insert id="WRK300_INSERT_FACILITY_INFO">
		<![CDATA[
        INSERT INTO WK_FACILITY_INFO
        (     PLANT_ID    /*사업장ID*/
            , TA_ID    /*TA ID*/
            , FACILITY_KND    /*설비종류*/
            , PROCESS_CD    /*공정*/
            , FACILITY_NO    /*설비번호*/
            , FACILITY_NM    /*설비명*/
            , RMK           /*비고*/
            , REG_ID      /*등록자ID*/
            , REG_DATE    /*등록일자*/
        ) 
		VALUES 
        (
              #PLANT_ID#    /*사업장ID*/
            , #TA_ID#    /*TA ID*/
            , #FACILITY_KND#    /*설비종류*/
            , #PROCESS_CD#    /*공정*/
            , #FACILITY_NO#    /*설비번호*/
            , #FACILITY_NM#    /*설비명*/
            , #RMK#         /*비고*/
            , #LOGINID#     /*등록자ID*/
            , GETDATE()     /*등록일자*/
        )        
        ]]>
		</insert>

		<insert id="WRK300_INSERT_SIGN_SHEET">
		<![CDATA[
		INSERT INTO WK_SIGN_SHEET
		(
			  PLANT_ID    /*사업장ID*/
			, TA_ID    /*TA ID*/
			, FACILITY_KND    /*설비종류*/
			, PROCESS_CD    /*공정*/
			, FACILITY_NO    /*설비번호*/
			, STEP_CD    /*단계*/
			, WK_STATUS    /*작업상태*/
			, MNGR_ID    /*담당자ID*/
			, COMP_DT    /*완료일자*/
			, RMK    /*비고*/
			, REG_ID    /*등록자ID*/
			, REG_DATE    /*등록일자*/
		) 
		VALUES 
		(
			  #PLANT_ID#    /*사업장ID*/
			, #TA_ID#    /*TA ID*/
			, #FACILITY_KND#    /*설비종류*/
			, #PROCESS_CD#    /*공정*/
			, #FACILITY_NO#    /*설비번호*/
			, #STEP_CD#    /*단계*/
			, #WK_STATUS#    /*작업상태*/
			, #LOGINID#    /*담당자ID*/
			, CONVERT(VARCHAR(8),GETDATE(),112)    /*완료일자*/
			, #RMK#    /*비고*/
            , #LOGINID#     /*등록자ID*/
            , GETDATE()     /*등록일자*/
		)   
        ]]>
		</insert>		

      <update id="WRK300_UPDATE">
        <![CDATA[
				UPDATE SE_TA_CMP
				SET
				 CMP_NM = #CMP_NM#				/*회사명*/
				,CMP_NO = #CMP_NO#				/*사업자번호*/
				,MNGR_NM = #MNGR_NM#			/*담당자명*/
				,MNGR_TEL_NO = #MNGR_TEL_NO#    /*연락처*/
				,MNGR_EMAIL = #MNGR_EMAIL#		/*EAMIL*/				
				,UPT_ID = #LoginedUserID#		/*UPT_ID*/
				,UPT_DT = GETDATE()				/*UPT_DT*/				
				 WHERE 1 = 1
				 AND CMP_ID = #CMP_ID#
            ]]>        
      </update>

		<select id="WRK300_CHECK_FACILITY_INFO">
			<![CDATA[
			SELECT  T1.STEP_CD
				   ,CASE WHEN EXISTS (SELECT 1
									  FROM WK_JOB_AUTH_MAPPING R1 LEFT OUTER JOIN E3_USER_AUTH_MAPPING R2 ON R1.AUTHORITY_ID = R2.AUTHORITY_ID
									 WHERE R2.USER_ID = #LOGINID#
									   AND R1.JOB_ID = T1.STEP_CD) THEN 'Y' ELSE 'N' END AS AUTH_YN
			 FROM WK_SIGN_SHEET T1
			WHERE PLANT_ID = #PLANT_ID#
			  AND TA_ID = #TA_ID#
			  AND FACILITY_KND = #FACILITY_KND#
			  AND PROCESS_CD = #PROCESS_CD#
			  AND FACILITY_NO = #FACILITY_NO#
			  AND NOT EXISTS (SELECT 1  
								FROM WK_SIGN_SHEET
							   WHERE PLANT_ID = T1.PLANT_ID
								 AND TA_ID = T1.TA_ID
								 AND FACILITY_KND = T1.FACILITY_KND
								 AND PROCESS_CD = T1.PROCESS_CD
								 AND FACILITY_NO = T1.FACILITY_NO
								 AND REG_DATE > T1.REG_DATE)
			]]>
		</select>		

      <delete id="WRK300_DELETE_FACILITY_INFO">
        <![CDATA[
                DELETE FROM WK_FACILITY_INFO
				WHERE 1 = 1
				AND PLANT_ID = #PLANT_ID#
				AND TA_ID = #TA_ID#
				AND FACILITY_KND = #FACILITY_KND#    
				AND PROCESS_CD = #PROCESS_CD#    
				AND FACILITY_NO = #FACILITY_NO#    
            ]]>        
      </delete>		
		
		<delete id="WRK300_DELETE_SIGN_SHEET">
			<![CDATA[
                DELETE FROM WK_SIGN_SHEET
				WHERE 1 = 1
				AND PLANT_ID = #PLANT_ID#
				AND TA_ID = #TA_ID#
				AND FACILITY_KND = #FACILITY_KND#    
				AND PROCESS_CD = #PROCESS_CD#    
				AND FACILITY_NO = #FACILITY_NO#    
            ]]>
		</delete>

		<delete id="WRK300_DELETE_SIGN_SHEET_STEP">
			<![CDATA[
                DELETE FROM WK_SIGN_SHEET
				WHERE 1 = 1
				AND PLANT_ID = #PLANT_ID#
				AND TA_ID = #TA_ID#
				AND FACILITY_KND = #FACILITY_KND#    
				AND PROCESS_CD = #PROCESS_CD#    
				AND FACILITY_NO = #FACILITY_NO# 
				AND STEP_CD = #STEP_CD#
            ]]>
		</delete>


		<select id="WRK300_CMP_NO_COUNT">
			<![CDATA[
			SELECT
				 COUNT(1) CNT
			FROM SE_TA_CMP A /*출입회사 관리*/
			WHERE 1 = 1
			AND CMP_NO = #CMP_NO#
			]]>

		</select>

		<select id="WRK300_CHECK_COMCODE">
			<![CDATA[
			SELECT COUNT(*) CNT
			  FROM E3_CODE
			 WHERE PARENT_ID = #PARENT_ID#
			   AND CODE_ID = #CODE_ID#
			]]>
			<isNotNull property="PLANT_CHECK">
				<isNotEmpty property="PLANT_CHECK">
					AND PLANT_ID = CASE WHEN ISNULL((SELECT PLANT_ID FROM E3_USER WHERE USER_ID = #LOGINID#), '') = '' THEN PLANT_ID
					ELSE (SELECT PLANT_ID FROM E3_USER WHERE USER_ID = #LOGINID#)
					END
				</isNotEmpty>
			</isNotNull>
		</select>

	</statements>
</sqlMap>