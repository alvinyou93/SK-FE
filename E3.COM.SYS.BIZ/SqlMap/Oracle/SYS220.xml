<?xml version="1.0" encoding="utf-8" ?>
<sqlMap namespace="E3.COM.SYS.BIZ" xmlns="http://ibatis.apache.org/mapping" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" >

  <statements>
	<select id="SYS220_USER_SELECT">
    <![CDATA[
        SELECT USER_ID 
	        , USER_NAME 
	        , USER_PASSWORD 
	        , USER_EMAIL
	        , USE_YN
          , REG_ID
          , REG_DATE 
          , MOD_ID 
          , MOD_DATE 
          , PASSWORD_CHANGE_YN 
          , PASSWORD_CHANGE_DATE 
          , FAIL_CNT
        FROM E3_USER
        WHERE 1=1
      ]]>
      <isNotNull property="searchUserId">
        <isNotEmpty property="searchUserId">
          <![CDATA[
              AND USER_ID LIKE CONCAT(CONCAT('%', #searchUserId#), '%')
              ]]>
        </isNotEmpty>
      </isNotNull>
      <isNotNull property="searchUserName">
        <isNotEmpty property="searchUserName">
          <![CDATA[
              AND USER_NAME LIKE CONCAT(CONCAT('%', #searchUserName#), '%')
              ]]>
        </isNotEmpty>
      </isNotNull>
    </select>
    
    <select id="SYS220_SELECT">
      <![CDATA[
        SELECT CASE WHEN UA.USER_ID IS NULL THEN 0
			        ELSE 1
			        END AS CHK
              , UA.USER_ID
		          , A.PLANT_ID 
              , A.AUTHORITY_ID
              , A.AUTHORITY_NAME 
              , A.AUTHORITY_DESC
              , A.USE_YN
              , A.REG_ID
              , A.REG_DATE
              , A.MOD_ID
              , A.MOD_DATE
        FROM E3_AUTH A
          LEFT JOIN (SELECT ua.USER_ID
				              , ua.AUTHORITY_ID
				             FROM E3_USER u
				              INNER JOIN E3_USER_AUTH_MAPPING ua
  				              ON u.USER_ID= ua.USER_ID
                     WHERE ua.USER_ID LIKE CONCAT(CONCAT('%', #userId#), '%')
				            ) UA
	            ON A.AUTHORITY_ID = UA.AUTHORITY_ID
      ]]>
    </select>
ã„´
    <insert id="SYS220_INSERT">
      <![CDATA[
        INSERT INTO E3_USER_AUTH_MAPPING (USER_ID, AUTHORITY_ID, USE_YN, REG_ID, REG_DATE)
        VALUES(#userId#, #authorityId#, 'Y', #LoginedUserID#, TO_DATE(#Now#, 'YYYY-MM-DD HH24:MI:SS'))
      ]]>
    </insert>

    <delete id="SYS220_DELETE">
      <![CDATA[
        DELETE FROM E3_USER_AUTH_MAPPING
        WHERE USER_ID = #userId#
      ]]>
    </delete>
    
	  <insert id="SYS220_AUTHCOPY_INSERT">
		  <![CDATA[
        INSERT INTO E3_USER_AUTH_MAPPING (USER_ID, AUTHORITY_ID, USE_YN, REG_ID, REG_DATE)
        SELECT #userId#
              , AUTHORITY_ID
              , USE_YN
              , #LoginedUserID#
              , TO_DATE(#Now#, 'YYYY-MM-DD HH24:MI:SS')
        FROM E3_USER_AUTH_MAPPING 
        WHERE USER_ID = #copyUserId#
		  ]]>
	  </insert>
    
  </statements>
</sqlMap>