<?xml version="1.0" encoding="euc-kr" ?>
<sqlMap namespace="E3.COM.SYS.BIZ" xmlns="http://ibatis.apache.org/mapping" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" >
  <statements>
    <select id="SYS230_SELECT">
      <![CDATA[
        SELECT CASE WHEN A.MENU_ID IS NULL THEN 0
			              ELSE 1
	             END AS CHK
          , M.MENU_ID
          , M.MENU_ID AS VALUE
          , M.MENU_NAME
          , M.PARENT_ID
          , M.MENU_DESCRIPTION 
          , M.USE_YN 
          , M.REG_ID 
          , M.REG_DATE 
          , M.MOD_ID 
          , M.MOD_DATE 
          , M.PROGRAM_ID
          , M.ORD 
        FROM E3_MENU M
	        LEFT JOIN ( SELECT AM.MENU_ID 
				              FROM E3_AUTH A
					              INNER JOIN E3_AUTH_MENU_MAPPING AM
						              ON A.AUTHORITY_ID = AM.AUTHORITY_ID
				              WHERE USE_YN = 'Y'
                      AND   AM.AUTHORITY_ID = #AUTHORITY_ID#) A
	        ON M.MENU_ID = A.MENU_ID
        ORDER BY LVL, ORD
      ]]>      
    </select>

    <insert id="SYS230_INSERT">
      <![CDATA[
        INSERT INTO E3_AUTH_MENU_MAPPING  (AUTHORITY_ID, MENU_ID, REG_ID, REG_DATE)
        VALUES(#authorityId#, #menuId#, #LoginedUserID#, GETDATE())
      ]]>
    </insert>

	<insert id="SYS230_INSERT_LIST" parameterClass="ArrayList">
		<![CDATA[
	    INSERT INTO E3_AUTH_MENU_MAPPING  (AUTHORITY_ID, MENU_ID, REG_ID, REG_DATE)
	    VALUES
	    ]]>
		<iterate property="param" index="index" collection="list" conjunction="), (" open="(" close=")">
		<![CDATA[
		#param[].authorityId#, #param[].menuId#, #param[].LoginedUserID#,  GETDATE()
	    ]]>
		</iterate >
	</insert>

    <delete id="SYS230_DELETE">
      <![CDATA[
        DELETE FROM E3_AUTH_MENU_MAPPING WHERE AUTHORITY_ID = #authorityId#
      ]]>
    </delete>
    
  </statements>
</sqlMap>