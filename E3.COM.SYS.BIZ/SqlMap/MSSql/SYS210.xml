<?xml version="1.0" encoding="euc-kr" ?>
<sqlMap namespace="E3.COM.SYS.BIZ" xmlns="http://ibatis.apache.org/mapping" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" >

  <statements>
      <select id="SYS210_AUTH_SELECT">
        <![CDATA[
            SELECT A.AUTHORITY_ID
              , A.AUTHORITY_NAME
              , A.AUTHORITY_DESC
              , A.PLANT_ID
              , A.USE_YN
              , A.REG_ID
              , A.REG_DATE
              , A.MOD_ID
              , A.MOD_DATE
			  , C.CODE_NAME AS PLANT_NAME
            FROM E3_AUTH A
            LEFT OUTER JOIN E3_CODE C ON (A.PLANT_ID=C.CODE_ID)
            WHERE 1=1
        ]]>
		<isNotNull property="authority_name">
			<isNotEmpty property="authority_name">
			    <![CDATA[
                AND A.PLANT_ID = #plant_id#
                ]]>
			</isNotEmpty>
		</isNotNull>
        <isNotNull property="authority_name">
            <isNotEmpty property="authority_name">
                <![CDATA[
                AND A.AUTHORITY_NAME LIKE concat(concat('%', #authority_name#), '%') 
                ]]>
            </isNotEmpty>
        </isNotNull>
        <isNotNull property="use_yn">
            <isNotEmpty property="use_yn">
                <![CDATA[
                AND A.USE_YN = #use_yn#
                ]]>
            </isNotEmpty>
        </isNotNull>
        <![CDATA[
          ORDER BY A.AUTHORITY_NAME, A.AUTHORITY_ID ASC
        ]]>
    </select>
    
    <select id="SYS210_SELECT">
        <![CDATA[
            SELECT plant_id as plantId 
                , (SELECT code_name FROM E3_CODE c WHERE c.code_id = a.plant_id) as plantName 
                , authority_id as authorityId
                , authority_name as authorityName
                , authority_desc as authorityDesc
                , use_yn as useYn
                ,(SELECT code_name FROM E3_CODE c WHERE c.code_id = a.use_yn) as useYnName 
                , reg_id as regId
                , reg_date as regDate
                , mod_id as modId
                , mod_date as modDate
            FROM e3_auth a
            WHERE 1=1
        ]]>
		<isNotNull property="plantId">
			<isNotEmpty property="plantId">
				<![CDATA[
                AND plant_id like concat(concat('%', #plantId#), '%')
                ]]>
			</isNotEmpty>
		</isNotNull>
		<isNotNull property="authorityId">
			<isNotEmpty property="authorityId">
				<![CDATA[
                AND authority_id like concat(concat('%', #authorityId#), '%')
                ]]>
			</isNotEmpty>
		</isNotNull>
		<![CDATA[
          ORDER BY authority_name, authority_id ASC
        ]]>
    </select>

    <select id="SYS210_COUNT">
      <![CDATA[
        SELECT COUNT(*) AS CNT FROM e3_auth
        WHERE 1=1
        AND authority_id=#authorityId# 
      ]]>
      
    </select>

    <insert id="SYS210_INSERT">
      <![CDATA[
        INSERT INTO e3_auth (plant_id, authority_id, authority_name, authority_desc, use_yn, reg_id, reg_date)
        VALUES (#plantId#, #authorityId#, #authorityName#, #authorityDesc#, #useYn#, #LoginedUserID#, convert(varchar, #Now#, 120))
      ]]>
    </insert>

    <update id="SYS210_UPDATE">
      <![CDATA[
        UPDATE e3_auth
          SET plant_id=#plantId#
          , authority_name=#authorityName#
          , authority_desc=#authorityDesc#
          , use_yn=#useYn#
          , mod_id=#LoginedUserID#
          , mod_date=convert(varchar, #Now#, 120)
        WHERE authority_id=#authorityId# 
      ]]>
    </update>

    <delete id="SYS210_DELETE">
      <![CDATA[
        DELETE FROM e3_auth
        WHERE plant_id=#plantId#
        AND  authority_id=#authorityId#
      ]]>
    </delete>
  </statements>
</sqlMap>